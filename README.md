# SillyTavern 云存档插件

## 概述

这是一个为 SillyTavern 设计的云存档插件，允许用户将 `/data` 目录的状态作为存档点保存到指定的 GitHub 仓库中。它提供了存档、回档、删除、重命名和比较存档差异等功能。

## 功能特性

- **基于 Git 标签**：每个存档都是一个 Git 标签，轻量且易于管理。
- **云端存储**：所有存档数据（标签和提交）存储在您的 GitHub 仓库中。
- **用户友好的界面**：提供直观的界面来管理存档。
- **主要操作**：
    - 创建新存档（带名称和描述）
    - 列出、搜索和排序存档
    - 加载（回档）到任意存档点
    - 删除存档
    - 重命名存档
    - 比较存档与当前状态的差异
- **工作区安全**：在加载存档前自动暂存未提交的更改，并允许用户恢复或丢弃这些更改。

## 安装与配置

1.  **放置插件**：将 `cloud_saves` 文件夹放置到 SillyTavern 的 `plugins` 目录下。
2.  **重启 SillyTavern**：确保 SillyTavern 重新加载插件。
3.  **打开插件界面**：在 SillyTavern 的插件菜单中找到并打开"Cloud Saves"。
4.  **创建 GitHub 仓库**：
    - 如果您还没有用于存储存档的仓库，请在 GitHub 上创建一个**私有**仓库（推荐）。
    - 您**不需要**在仓库中预先创建任何文件。
5.  **生成 GitHub 访问令牌**：
    - 前往您的 GitHub [开发者设置 > 个人访问令牌](https://github.com/settings/tokens)。
    - 创建一个新的令牌（Fine-grained tokens 或 Classic tokens 均可）。
    - 确保证令牌具有 `repo` 权限（或者对于 Fine-grained tokens，至少对您创建的存档仓库具有读写权限）。
    - **复制生成的令牌**，您将无法再次看到它。
6.  **授权插件**：
    - 在插件界面的"仓库授权设置"部分：
        - 粘贴您的 GitHub 仓库 URL（例如 `https://github.com/your-username/your-repo-name`）。
        - 粘贴您刚刚生成的 GitHub 访问令牌。
        - 点击"授权并连接"按钮。
    - 如果一切顺利，状态将显示为已授权，并且存档管理部分将变为可用。

## 使用方法

- **创建存档**：输入存档名称（必填）和描述（可选），然后点击"保存当前状态"按钮。
- **加载存档**：在存档列表中找到您想要恢复的存档，点击右侧的 <i class="bi bi-cloud-download"></i> (加载) 按钮，并在确认对话框中确认。
- **重命名存档**：点击存档卡片上的 <i class="bi bi-pencil"></i> (重命名) 按钮，在弹出的模态框中修改名称和描述，然后保存。
- **删除存档**：点击存档卡片上的 <i class="bi bi-trash"></i> (删除) 按钮，并在确认对话框中确认。
- **比较差异**：点击存档卡片上的 <i class="bi bi-file-diff"></i> (差异) 按钮，可以查看该存档与您当前 `/data` 目录状态之间的文件差异。
- **搜索与排序**：使用列表上方的搜索框和排序下拉菜单来查找和整理存档。
- **恢复临时更改**：如果在加载存档时有未提交的更改被暂存，界面下方会出现通知，您可以选择"恢复这些更改"或"丢弃这些更改"。

## 注意事项

- **Git 环境**：请确保您的服务器环境已安装 Git。
- **网络连接**：所有与远程仓库交互的操作都需要稳定的网络连接。
- **仓库权限**：提供的 GitHub 令牌必须具有对目标仓库的读写权限。
- **大型文件**：如果您的 `data` 目录包含非常大的文件，建议在您的 Git 仓库中启用并配置 Git LFS (Large File Storage) 以获得更好的性能。

## 技术细节

- **后端**：Node.js, Express.js
- **核心逻辑**：通过 `child_process` 执行 Git 命令
- **前端**：HTML, CSS (Bootstrap 5), JavaScript

---

*由 AI 助手协助创建* 